# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –®–ª—é–∑–∞ –∏ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –î–∞–Ω–Ω—ã—Ö (Data Flow)

## 1. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –ê–¥–∞–ø—Ç–µ—Ä–∞ (Compiler Layer)

–í —Ö–æ–¥–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –±—ã–ª–æ –ø—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö (**Blockly**) –∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å –¥–∞–Ω–Ω—ã—Ö (**Vue UI**). –î–ª—è —ç—Ç–æ–≥–æ –±—ã–ª –≤–Ω–µ–¥—Ä–µ–Ω –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Å–ª–æ–π ‚Äî **–®–ª—é–∑ (Compiler)**.

**–¶–µ–ª—å:** –ò–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã JSON, –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–π Blockly, –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—É–¥—É—â–µ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

## 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–î–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ –ª–æ–≥–∏–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –±—ã–ª–∞ –≤—ã–¥–µ–ª–µ–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:

```text
src/
‚îú‚îÄ‚îÄ compiler/           # –°–ª–æ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ index.ts        # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (–®–ª—é–∑)
‚îÇ   ‚îú‚îÄ‚îÄ transformer.ts  # [–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ] –õ–æ–≥–∏–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞ –±–ª–æ–∫–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ types.ts        # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ composables/
‚îÇ   ‚îî‚îÄ‚îÄ useBlockly.ts   # –õ–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Blockly
‚îî‚îÄ‚îÄ App.vue             # –î–∏—Ä–∏–∂–µ—Ä –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö

```

## 3. –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –≠—Ç–∞–ø 1: –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –®–ª—é–∑–∞

–í `src/compiler/index.ts` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª "–ø—Ä–æ–ø—É—Å–∫–Ω–æ–≥–æ –ø—É–Ω–∫—Ç–∞". –ù–∞ –¥–∞–Ω–Ω–æ–º —ç—Ç–∞–ø–µ —Ñ—É–Ω–∫—Ü–∏—è `compile` –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–æ–ª—å Pass-through –∞–¥–∞–ø—Ç–µ—Ä–∞, –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞—è –º–µ—Å—Ç–æ –¥–ª—è –±—É–¥—É—â–µ–π –ª–æ–≥–∏–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞.

```typescript
// src/compiler/index.ts
export const useCompiler = () => {
  const compile = (rawData: any) => {
    console.log("üöÄ –®–õ–Æ–ó: –ü–æ–ª—É—á–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏", rawData);
    // –ù–∞ —Ç–µ–∫—É—â–µ–º —ç—Ç–∞–ø–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ –µ—Å—Ç—å (–∏–º–∏—Ç–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏)
    return rawData; 
  };
  return { compile };
};

```

### –≠—Ç–∞–ø 2: –ò–º–∏—Ç–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Timeout Test)

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–π —Ü–µ–ø–æ—á–∫–∏ –≤ `App.vue` –º–Ω–æ—é –±—ã–ª –ø—Ä–æ–≤–µ–¥–µ–Ω —Ç–µ—Å—Ç —Å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏–ª–æ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å, —á—Ç–æ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –®–ª—é–∑ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –∞ UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

**–•–æ–¥ —Ç–µ—Å—Ç–∞:**

1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `mySiteObject` –ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º.
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `setTimeout` (2000–º—Å) –¥–ª—è –∏–º–∏—Ç–∞—Ü–∏–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–∏—Ö–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö.
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è `watch` –∏ –º–µ—Ç–æ–¥–∞ `compile`.

### –≠—Ç–∞–ø 3: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä—è–º–æ–π —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ (Live Stream)

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –∏–º–∏—Ç–∞—Ü–∏–∏ —è –ø–µ—Ä–µ—à–µ–ª –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø—Ä—è–º–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Blockly.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `useBlockly.ts`:**
–ë—ã–ª –≤–Ω–µ–¥—Ä–µ–Ω —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–Ω–∞–ª `latestJson`. –í –º–µ—Ç–æ–¥–µ `handleWorkspaceChange` —è –∑–∞–º–µ–Ω–∏–ª –ø—Ä–æ—Å—Ç–æ–π –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –∑–∞–ø–∏—Å—å –≤ —ç—Ç–æ—Ç –∫–∞–Ω–∞–ª:

```typescript
const latestJson = ref<any>(null);

function handleWorkspaceChange(event: any) {
  if (event.isUiEvent) return;
  
  const jsonOutput = generateWorkspaceJson(workspace.value);
  latestJson.value = jsonOutput; // –ü—Ä–æ–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ—Ç–æ–∫
}

```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `App.vue`:**
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ "–ø—Ä–æ—Å–ª—É—à–∫–∏" –∂–∏–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞ —á–µ—Ä–µ–∑ `watch`:

```typescript
const { latestJson } = useBlockly();
const { compile } = useCompiler();

watch(latestJson, (newRawData) => {
  if (newRawData) {
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ —à–ª—é–∑ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ –±–ª–æ–∫–∞
    mySiteObject.value = compile(newRawData);
  }
}, { deep: true });

```

## 4. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –¥–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

* **–°–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (Coupling):** –°–Ω–∏–∂–µ–Ω–∞. `App.vue` –Ω–µ –∑–Ω–∞–µ—Ç –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ JSON Blockly.
* **–†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** –î–æ–±–∏–ª–∏—Å—å –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–µ–≤—å—é —Å–∞–π—Ç–∞ –ø—Ä–∏ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è—Ö –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ (BLOCK_MOVE, BLOCK_CREATE).
* **–ö–æ–Ω—Ç—Ä–æ–ª—å:** –í–≤–µ–¥–µ–Ω –ø—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å –≤ —à–ª—é–∑–µ, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—é—â–∏–π –ø–æ–ø—ã—Ç–∫–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –Ω–∞ —ç—Ç–∞–ø–µ –∏—Ö –æ—Ç–ª–∞–¥–∫–∏.

---

## 5. –î–∞–ª—å–Ω–µ–π—à–∏–µ —à–∞–≥–∏

* –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä—Å–µ—Ä–∞ –≤ `transformer.ts` –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ Blockly (`languageVersion`, `inputs`) –≤ –ø–ª–æ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä—è–¥–æ–≤ –∏ –±–ª–æ–∫–æ–≤ –Ω–∞—à–µ–≥–æ —Å–∞–π—Ç–∞.
* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–∞–ø–ø–∏–Ω–≥–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∞—Å—Å–µ—Ç–æ–≤ (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π) –≤–Ω—É—Ç—Ä–∏ —à–ª—é–∑–∞.

